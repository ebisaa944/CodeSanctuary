<!-- learning/templates/learning/external_courses.html -->
{% extends 'learning/base.html' %}
{% load static %}
{% load learning_filters %}

{% block title %}External Learning Resources - Code Sanctuary{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
    /* External Courses Specific Styles */
    .search-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px 0;
        margin-bottom: 40px;
        border-radius: 10px;
    }
    
    .search-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 20px;
    }
    
    .search-title {
        font-size: 2.5rem;
        font-weight: 300;
        margin-bottom: 10px;
    }
    
    .search-subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
        margin-bottom: 30px;
    }
    
    .search-form-large {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }
    
    .search-input-large {
        flex: 1;
        padding: 15px 20px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .search-btn-large {
        padding: 15px 30px;
        background: #27ae60;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: background 0.3s;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .search-btn-large:hover {
        background: #229954;
        transform: translateY(-2px);
    }
    
    .platform-filter-section {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }
    
    .filter-title {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 1.3rem;
    }
    
    .platform-filter-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .platform-card {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        color: inherit;
    }
    
    .platform-card:hover {
        border-color: #3498db;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .platform-card.active {
        border-color: #3498db;
        background: #e3f2fd;
    }
    
    .platform-icon {
        font-size: 2.5rem;
        margin-bottom: 10px;
        color: #3498db;
    }
    
    .platform-name {
        font-weight: 600;
        margin-bottom: 5px;
        color: #2c3e50;
    }
    
    .platform-desc {
        font-size: 0.9rem;
        color: #7f8c8d;
    }
    
    /* Course Cards */
    .course-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
    }
    
    .course-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transition: all 0.3s;
        border: 1px solid #e0e0e0;
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    
    .course-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .course-header {
        padding: 20px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-bottom: 1px solid #e0e0e0;
    }
    
    .course-platform {
        display: inline-block;
        padding: 4px 12px;
        background: #3498db;
        color: white;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .course-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 10px;
        line-height: 1.4;
    }
    
    .course-description {
        color: #666;
        font-size: 0.95rem;
        line-height: 1.5;
        margin-bottom: 15px;
    }
    
    .course-body {
        padding: 20px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }
    
    .course-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .meta-item {
        display: flex;
        align-items: center;
        gap: 5px;
        color: #666;
        font-size: 0.9rem;
    }
    
    .meta-icon {
        color: #3498db;
    }
    
    .difficulty-badge {
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .beginner { background: #d4edda; color: #155724; }
    .intermediate { background: #fff3cd; color: #856404; }
    .advanced { background: #f8d7da; color: #721c24; }
    
    .free-badge {
        background: #d4edda;
        color: #155724;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
    }
    
    .course-footer {
        padding: 15px 20px;
        background: #f8f9fa;
        border-top: 1px solid #e0e0e0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: auto;
    }
    
    .btn-group {
        display: flex;
        gap: 10px;
    }
    
    .btn-sm {
        padding: 8px 16px;
        border-radius: 4px;
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.3s;
    }
    
    .btn-outline-primary {
        border: 2px solid #3498db;
        color: #3498db;
        background: transparent;
    }
    
    .btn-outline-primary:hover {
        background: #3498db;
        color: white;
    }
    
    .btn-primary {
        background: #3498db;
        color: white;
        border: 2px solid #3498db;
    }
    
    .btn-primary:hover {
        background: #2980b9;
        border-color: #2980b9;
    }
    
    .btn-success {
        background: #27ae60;
        color: white;
        border: 2px solid #27ae60;
    }
    
    .btn-success:hover {
        background: #229954;
        border-color: #229954;
    }
    
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin: 40px 0;
    }
    
    .empty-icon {
        font-size: 4rem;
        color: #ddd;
        margin-bottom: 20px;
    }
    
    .empty-title {
        color: #7f8c8d;
        margin-bottom: 10px;
    }
    
    .empty-message {
        color: #95a5a6;
        max-width: 500px;
        margin: 0 auto 20px;
    }
    
    /* Stats Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 30px 0;
    }
    
    .stat-card {
        background: white;
        padding: 25px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        transition: transform 0.3s;
    }
    
    .stat-card:hover {
        transform: translateY(-3px);
    }
    
    .stat-icon {
        font-size: 2.5rem;
        color: #3498db;
        margin-bottom: 15px;
    }
    
    .stat-number {
        font-size: 2.2rem;
        font-weight: 700;
        color: #2c3e50;
        display: block;
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: #7f8c8d;
        font-size: 0.9rem;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .course-grid {
            grid-template-columns: 1fr;
        }
        
        .platform-filter-grid {
            grid-template-columns: 1fr;
        }
        
        .search-form-large {
            flex-direction: column;
        }
        
        .btn-group {
            flex-direction: column;
            width: 100%;
        }
        
        .btn-sm {
            width: 100%;
            text-align: center;
            margin-bottom: 5px;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Search Section -->
<div class="search-section">
    <div class="search-container">
        <h1 class="search-title">Discover Learning Resources</h1>
        <p class="search-subtitle">Explore courses from top platforms. Expand your therapeutic coding journey.</p>
        
        <form method="get" action="{% url 'learning:external_courses' %}" class="search-form-large">
            <input type="text" 
                   name="search" 
                   class="search-input-large" 
                   placeholder="Search courses by title, language, or topic..."
                   value="{{ search_query }}"
                   aria-label="Search courses">
            <button type="submit" class="search-btn-large">
                <i class="fas fa-search me-2"></i>Search
            </button>
        </form>
        
        {% if search_query %}
        <div class="d-flex justify-content-between align-items-center">
            <span class="text-light">Search results for: <strong>"{{ search_query }}"</strong></span>
            <a href="{% url 'learning:external_courses' %}" class="btn btn-light btn-sm">
                Clear Search
            </a>
        </div>
        {% endif %}
    </div>
</div>

<div class="container">
    <!-- Platform Filter Section -->
    <div class="platform-filter-section">
        <h3 class="filter-title">Browse by Platform</h3>
        
        <div class="platform-filter-grid">
            <a href="{% url 'learning:external_courses' %}" 
               class="platform-card {% if not selected_platform %}active{% endif %}">
                <div class="platform-icon">
                    <i class="fas fa-globe"></i>
                </div>
                <div class="platform-name">All Platforms</div>
                <div class="platform-desc">Browse all available courses</div>
            </a>
            
            {% for platform in platforms %}
            <a href="{% url 'learning:external_courses' %}?platform={{ platform.id }}" 
               class="platform-card {% if selected_platform == platform.id %}active{% endif %}">
                <div class="platform-icon">
                    {% if platform.id == 'freecodecamp' %}
                    <i class="fab fa-free-code-camp"></i>
                    {% elif platform.id == 'udemy' %}
                    <i class="fas fa-video"></i>
                    {% elif platform.id == 'coursera' %}
                    <i class="fas fa-university"></i>
                    {% else %}
                    <i class="fas fa-external-link-alt"></i>
                    {% endif %}
                </div>
                <div class="platform-name">{{ platform.name }}</div>
                <div class="platform-desc">{{ platform.description }}</div>
            </a>
            {% endfor %}
        </div>
        
        <!-- Category Filter -->
        <div class="mt-4">
            <h6 class="mb-3">Filter by Category:</h6>
            <div class="d-flex flex-wrap gap-2">
                {% for cat in categories %}
                <a href="{% url 'learning:external_courses' %}?category={{ cat.id }}{% if selected_platform %}&platform={{ selected_platform }}{% endif %}" 
                   class="btn btn-outline-secondary btn-sm {% if selected_category == cat.id %}active{% endif %}">
                    {{ cat.name }}
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <!-- Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-book-open"></i>
            </div>
            <span class="stat-number">{{ courses|length }}</span>
            <span class="stat-label">Courses Available</span>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <span class="stat-number">{{ platforms|length }}</span>
            <span class="stat-label">Learning Platforms</span>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-language"></i>
            </div>
            <span class="stat-number">{{ categories|length }}</span>
            <span class="stat-label">Categories</span>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-heart"></i>
            </div>
            <span class="stat-number">{{ user.recommended_courses_count|default:0 }}</span>
            <span class="stat-label">Recommended for You</span>
        </div>
    </div>
    
    <!-- Courses Grid -->
    {% if courses %}
    <div class="row mb-4">
        <div class="col">
            <h3>
                {% if search_query %}
                Search Results
                {% elif selected_platform %}
                {{ selected_platform|title }} Courses
                {% else %}
                All Available Courses
                {% endif %}
                <small class="text-muted">({{ courses|length }} found)</small>
            </h3>
        </div>
    </div>
    
    <div class="course-grid">
        {% for course in courses %}
        <div class="course-card">
            <div class="course-header">
                <span class="course-platform">{{ course.platform }}</span>
                <h4 class="course-title">{{ course.title }}</h4>
                <p class="course-description">{{ course.description|truncatechars:150 }}</p>
            </div>
            
            <div class="course-body">
                <div class="course-meta">
                    <span class="meta-item">
                        <i class="fas fa-signal meta-icon"></i>
                        <span class="difficulty-badge {{ course.difficulty|lower }}">
                            {{ course.difficulty }}
                        </span>
                    </span>
                    
                    <span class="meta-item">
                        <i class="far fa-clock meta-icon"></i>
                        {{ course.estimated_time }}
                    </span>
                    
                    <span class="meta-item">
                        <i class="fas fa-code meta-icon"></i>
                        {{ course.language }}
                    </span>
                    
                    {% if course.is_free %}
                    <span class="meta-item">
                        <span class="free-badge">Free</span>
                    </span>
                    {% endif %}
                    
                    {% if course.rating %}
                    <span class="meta-item">
                        <i class="fas fa-star meta-icon"></i>
                        {{ course.rating }} ‚≠ê
                    </span>
                    {% endif %}
                </div>
                
                <div class="mt-auto">
                    {% if course.university %}
                    <p class="mb-2"><i class="fas fa-university me-2"></i>{{ course.university }}</p>
                    {% endif %}
                    
                    {% if course.students %}
                    <p class="mb-0 text-muted"><small><i class="fas fa-users me-1"></i>{{ course.students }} students</small></p>
                    {% endif %}
                </div>
            </div>
            
            <div class="course-footer">
                <div class="btn-group">
                    <a href="{{ course.url }}" 
                       target="_blank" 
                       class="btn-sm btn-outline-primary"
                       title="Visit course on {{ course.platform }}">
                        <i class="fas fa-external-link-alt me-1"></i> Visit
                    </a>
                    
                    <a href="{% url 'learning:external_course_detail' platform_name=course.platform|lower external_id=course.external_id %}" 
                       class="btn-sm btn-primary">
                        <i class="fas fa-info-circle me-1"></i> Details
                    </a>
                </div>
                
                <a href="{% url 'learning:import_external_course' platform_name=course.platform|lower external_id=course.external_id %}" 
                   class="btn-sm btn-success">
                    <i class="fas fa-plus me-1"></i> Add to Plan
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Therapeutic Reminder -->
    <div class="alert alert-therapeutic mt-4">
        <div class="d-flex">
            <i class="fas fa-hands-helping me-3 fa-2x text-primary"></i>
            <div>
                <h6 class="alert-heading">Therapeutic Learning Tip</h6>
                <p class="mb-0">Choose courses that match your current energy level. It's okay to start small and build up gradually.</p>
            </div>
        </div>
    </div>
    
    {% else %}
    <!-- Empty State -->
    <div class="empty-state">
        <div class="empty-icon">
            <i class="fas fa-search"></i>
        </div>
        <h3 class="empty-title">No courses found</h3>
        <p class="empty-message">
            {% if search_query %}
            No courses match your search "{{ search_query }}". Try a different search term or browse all platforms.
            {% else %}
            No courses available in this category. Try selecting a different platform or category.
            {% endif %}
        </p>
        <div class="d-flex gap-2 justify-content-center">
            <a href="{% url 'learning:external_courses' %}" class="btn btn-primary">
                <i class="fas fa-redo me-1"></i> View All Courses
            </a>
            <a href="{% url 'learning:personal_learning_plan' %}" class="btn btn-outline-primary">
                <i class="fas fa-list me-1"></i> View My Plan
            </a>
        </div>
    </div>
    {% endif %}
    
    <!-- Personal Learning Plan CTA -->
    <div class="card mt-5 border-therapeutic">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h4 class="card-title">Build Your Personal Learning Plan</h4>
                    <p class="card-text">Combine external courses with therapeutic activities for a personalized learning journey.</p>
                    <a href="{% url 'learning:personal_learning_plan' %}" class="btn btn-lg btn-therapeutic">
                        <i class="fas fa-calendar-plus me-2"></i>View My Learning Plan
                    </a>
                </div>
                <div class="col-md-4 text-center">
                    <i class="fas fa-road fa-4x text-muted"></i>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
$(document).ready(function() {
    // Filter platform cards on click
    $('.platform-card').on('click', function(e) {
        $('.platform-card').removeClass('active');
        $(this).addClass('active');
    });
    
    // Search form enhancement
    $('.search-input-large').focus(function() {
        $(this).parent().addClass('focused');
    }).blur(function() {
        $(this).parent().removeClass('focused');
    });
    
    // Load therapeutic recommendations
    $.ajax({
        url: "{% url 'learning:get_recommendations' %}",
        method: 'GET',
        success: function(response) {
            if (response.recommendations && response.recommendations.length > 0) {
                const rec = response.recommendations[0];
                $('.therapeutic-reminder').html(`
                    <i class="fas fa-lightbulb me-2"></i>
                    <strong>Recommended for your current state:</strong> 
                    ${rec.activity.title} (${rec.reason})
                `);
            }
        }
    });
    
    // Track course views for recommendations
    $('.course-card').on('click', function() {
        const courseId = $(this).data('course-id');
        if (courseId) {
            $.ajax({
                url: "/learning/api/track-course-view/",
                method: 'POST',
                data: {
                    course_id: courseId,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                }
            });
        }
    });
});
</script>
{% endblock %}