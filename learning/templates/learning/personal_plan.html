<!-- learning/templates/learning/personal_plan.html -->
{% extends 'learning/base.html' %}
{% load static %}

{% block title %}My Learning Plan - Code Sanctuary{% endblock %}

{% block extra_css %}
<style>
    .plan-header {
        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
        color: white;
        padding: 40px 0;
        margin-bottom: 40px;
        border-radius: 0 0 20px 20px;
    }
    
    .plan-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 20px;
        margin: 30px 0;
    }
    
    .stat-card-plan {
        background: rgba(255,255,255,0.1);
        padding: 25px;
        border-radius: 10px;
        text-align: center;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.2);
    }
    
    .stat-icon-plan {
        font-size: 2.5rem;
        margin-bottom: 15px;
        opacity: 0.9;
    }
    
    .stat-number-plan {
        font-size: 2.2rem;
        font-weight: 700;
        display: block;
        margin-bottom: 5px;
    }
    
    .stat-label-plan {
        font-size: 0.9rem;
        opacity: 0.8;
    }
    
    .plan-tabs {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }
    
    .tab-header {
        display: flex;
        border-bottom: 2px solid #f0f0f0;
    }
    
    .tab-btn {
        padding: 15px 30px;
        background: none;
        border: none;
        font-weight: 600;
        color: #666;
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
    }
    
    .tab-btn.active {
        color: #6a11cb;
    }
    
    .tab-btn.active::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        right: 0;
        height: 3px;
        background: #6a11cb;
    }
    
    .tab-content {
        padding: 30px;
        display: none;
    }
    
    .tab-content.active {
        display: block;
    }
    
    .course-item {
        display: flex;
        align-items: center;
        padding: 20px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-bottom: 15px;
        transition: all 0.3s;
        background: white;
    }
    
    .course-item:hover {
        border-color: #6a11cb;
        box-shadow: 0 4px 12px rgba(106, 17, 203, 0.1);
        transform: translateY(-2px);
    }
    
    .course-icon {
        font-size: 2rem;
        color: #6a11cb;
        margin-right: 20px;
        min-width: 50px;
    }
    
    .course-content {
        flex: 1;
    }
    
    .course-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
    }
    
    .course-meta {
        display: flex;
        gap: 15px;
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 10px;
    }
    
    .progress-container {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .progress-bar-plan {
        flex: 1;
        height: 8px;
        background: #f0f0f0;
        border-radius: 4px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #6a11cb, #2575fc);
        border-radius: 4px;
    }
    
    .progress-text {
        font-weight: 600;
        color: #6a11cb;
        min-width: 50px;
    }
    
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
    }
    
    .empty-icon {
        font-size: 4rem;
        color: #ddd;
        margin-bottom: 20px;
    }
    
    .btn-add-course {
        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 6px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s;
    }
    
    .btn-add-course:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(106, 17, 203, 0.3);
        color: white;
    }
    
    @media (max-width: 768px) {
        .course-item {
            flex-direction: column;
            text-align: center;
        }
        
        .course-icon {
            margin-right: 0;
            margin-bottom: 15px;
        }
        
        .progress-container {
            flex-direction: column;
            gap: 10px;
        }
        
        .tab-header {
            flex-direction: column;
        }
        
        .tab-btn {
            text-align: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="plan-header">
    <div class="container">
        <h1 class="mb-3">My Learning Plan</h1>
        <p class="mb-0">Your personalized therapeutic learning journey</p>
        
        <div class="plan-stats">
            <div class="stat-card-plan">
                <div class="stat-icon-plan">
                    <i class="fas fa-book-open"></i>
                </div>
                <span class="stat-number-plan">{{ total_courses }}</span>
                <span class="stat-label-plan">Total Courses</span>
            </div>
            
            <div class="stat-card-plan">
                <div class="stat-icon-plan">
                    <i class="fas fa-spinner"></i>
                </div>
                <span class="stat-number-plan">{{ in_progress }}</span>
                <span class="stat-label-plan">In Progress</span>
            </div>
            
            <div class="stat-card-plan">
                <div class="stat-icon-plan">
                    <i class="fas fa-check-circle"></i>
                </div>
                <span class="stat-number-plan">{{ completed }}</span>
                <span class="stat-label-plan">Completed</span>
            </div>
            
            <div class="stat-card-plan">
                <div class="stat-icon-plan">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <span class="stat-number-plan">{{ user.current_streak|default:0 }}</span>
                <span class="stat-label-plan">Day Streak</span>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="plan-tabs">
        <div class="tab-header">
            <button class="tab-btn active" data-tab="current">Current Courses</button>
            <button class="tab-btn" data-tab="recommended">Recommended</button>
            <button class="tab-btn" data-tab="completed">Completed</button>
        </div>
        
        <!-- Current Courses Tab -->
        <div class="tab-content active" id="current-tab">
            {% if saved_courses %}
            <div class="mb-4">
                <a href="{% url 'learning:external_courses' %}" class="btn-add-course">
                    <i class="fas fa-plus"></i> Add More Courses
                </a>
            </div>
            
            {% for course in saved_courses %}
            <div class="course-item">
                <div class="course-icon">
                    {% if course.platform == 'freecodecamp' %}
                    <i class="fab fa-free-code-camp"></i>
                    {% elif course.platform == 'udemy' %}
                    <i class="fas fa-video"></i>
                    {% elif course.platform == 'coursera' %}
                    <i class="fas fa-university"></i>
                    {% else %}
                    <i class="fas fa-external-link-alt"></i>
                    {% endif %}
                </div>
                
                <div class="course-content">
                    <div class="course-title">{{ course.title }}</div>
                    <div class="course-meta">
                        <span><i class="fas fa-external-link-alt me-1"></i>{{ course.platform|title }}</span>
                        <span><i class="far fa-clock me-1"></i>Last accessed: {{ course.last_accessed }}</span>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-bar-plan">
                            <div class="progress-fill" style="width: {{ course.progress }}%"></div>
                        </div>
                        <div class="progress-text">{{ course.progress }}%</div>
                    </div>
                </div>
                
                <div class="ms-3">
                    <a href="{{ course.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-play me-1"></i> Continue
                    </a>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-calendar-plus"></i>
                </div>
                <h4>No courses in your plan yet</h4>
                <p class="mb-4">Start building your personalized learning journey by adding courses from external platforms.</p>
                <a href="{% url 'learning:external_courses' %}" class="btn-add-course">
                    <i class="fas fa-plus me-2"></i>Browse Courses to Add
                </a>
            </div>
            {% endif %}
        </div>
        
        <!-- Recommended Tab -->
        <div class="tab-content" id="recommended-tab">
            {% if recommended_courses %}
            <p class="text-muted mb-4">Based on your learning profile and therapeutic goals</p>
            
            {% for course in recommended_courses|slice:":5" %}
            <div class="course-item">
                <div class="course-icon">
                    {% if course.platform == 'FreeCodeCamp' %}
                    <i class="fab fa-free-code-camp"></i>
                    {% elif course.platform == 'Udemy' %}
                    <i class="fas fa-video"></i>
                    {% elif course.platform == 'Coursera' %}
                    <i class="fas fa-university"></i>
                    {% else %}
                    <i class="fas fa-external-link-alt"></i>
                    {% endif %}
                </div>
                
                <div class="course-content">
                    <div class="course-title">{{ course.title }}</div>
                    <div class="course-meta">
                        <span><i class="fas fa-external-link-alt me-1"></i>{{ course.platform }}</span>
                        <span><i class="far fa-clock me-1"></i>{{ course.estimated_time }}</span>
                        <span class="badge bg-{{ course.difficulty|lower }}">{{ course.difficulty }}</span>
                    </div>
                    <p class="text-muted mb-0">{{ course.description|truncatechars:150 }}</p>
                </div>
                
                <div class="ms-3">
                    <a href="{% url 'learning:import_external_course' platform_name=course.platform|lower external_id=course.external_id %}" 
                       class="btn btn-sm btn-success">
                        <i class="fas fa-plus me-1"></i> Add to Plan
                    </a>
                </div>
            </div>
            {% endfor %}
            
            <div class="text-center mt-4">
                <a href="{% url 'learning:external_courses' %}" class="btn-add-course">
                    <i class="fas fa-search me-2"></i>Browse All Recommendations
                </a>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <h4>No recommendations yet</h4>
                <p class="mb-4">Complete your learning profile to get personalized course recommendations.</p>
                <a href="{% url 'learning:external_courses' %}" class="btn-add-course">
                    <i class="fas fa-search me-2"></i>Browse All Courses
                </a>
            </div>
            {% endif %}
        </div>
        
        <!-- Completed Tab -->
        <div class="tab-content" id="completed-tab">
            {% if saved_courses and completed > 0 %}
            <p class="text-muted mb-4">Celebrate your learning achievements!</p>
            
            {% for course in saved_courses %}
            {% if course.progress == 100 %}
            <div class="course-item" style="background: #e8f5e9; border-color: #4CAF50;">
                <div class="course-icon" style="color: #4CAF50;">
                    <i class="fas fa-check-circle"></i>
                </div>
                
                <div class="course-content">
                    <div class="course-title">{{ course.title }}</div>
                    <div class="course-meta">
                        <span><i class="fas fa-external-link-alt me-1"></i>{{ course.platform|title }}</span>
                        <span><i class="fas fa-check me-1 text-success"></i>Completed</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar-plan">
                            <div class="progress-fill" style="width: 100%; background: #4CAF50;"></div>
                        </div>
                        <div class="progress-text" style="color: #4CAF50;">100%</div>
                    </div>
                </div>
                
                <div class="ms-3">
                    <button class="btn btn-sm btn-outline-success">
                        <i class="fas fa-certificate me-1"></i> View Certificate
                    </button>
                </div>
            </div>
            {% endif %}
            {% endfor %}
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <h4>No completed courses yet</h4>
                <p class="mb-4">Keep going! Every step in your learning journey is valuable.</p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Therapeutic Reminder -->
    <div class="alert alert-therapeutic mt-4">
        <div class="d-flex">
            <i class="fas fa-hands-helping me-3 fa-2x text-primary"></i>
            <div>
                <h6 class="alert-heading">Therapeutic Learning Reminder</h6>
                <p class="mb-0">Progress at your own pace. Every small step is valuable. Take breaks when needed and celebrate your progress along the way.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Tab functionality
    $('.tab-btn').on('click', function() {
        const tabId = $(this).data('tab');
        
        // Update active tab button
        $('.tab-btn').removeClass('active');
        $(this).addClass('active');
        
        // Show corresponding tab content
        $('.tab-content').removeClass('active');
        $(`#${tabId}-tab`).addClass('active');
    });
    
    // Load course progress from localStorage or calculate
    $('.course-item').each(function() {
        const courseTitle = $(this).find('.course-title').text();
        const storedProgress = localStorage.getItem(`progress_${courseTitle}`);
        
        if (storedProgress) {
            const progress = parseInt(storedProgress);
            $(this).find('.progress-fill').css('width', progress + '%');
            $(this).find('.progress-text').text(progress + '%');
        }
    });
    
    // Therapeutic pacing suggestion
    const today = new Date().toLocaleDateString('en-US', { weekday: 'long' });
    const pacingTips = {
        'Monday': 'Start the week with gentle learning. Aim for 30-45 minutes.',
        'Tuesday': 'Build momentum. Try a focused 60-minute session.',
        'Wednesday': 'Mid-week check-in. Review what you\'ve learned.',
        'Thursday': 'Deep dive day. Tackle challenging concepts.',
        'Friday': 'Wrap up the week. Complete small tasks.',
        'Saturday': 'Weekend exploration. Learn something fun!',
        'Sunday': 'Rest and reflection. Plan for the week ahead.'
    };
    
    if (pacingTips[today]) {
        $('<div class="alert alert-info mt-3"><i class="fas fa-calendar-day me-2"></i><strong>' + today + ' Tip:</strong> ' + pacingTips[today] + '</div>').insertAfter('.plan-tabs');
    }
});
</script>
{% endblock %}